@top PROGRAM {
  exprM
}

@skip {
  space | COMMENT
}

DELIM {
  "â‹„" | "," | newline
}

exprM {
  DELIM* stmt (DELIM+ stmt)* DELIM*
}

stmt {
    EXPR { expr0+ }
  | ASSIGN { expr0+ "â†" stmt }
  | EXPORT { expr0* "â‡" stmt? }
}

expr0 {
    atom
  | STRIDE { atom ("â€¿" atom)+ }
}

atom {
    simpleAtom
  | PRIMFUN { primfun }
  | PRIMMOD1 { primmod1 }
  | PRIMMOD2 { primmod2 }
  | PUNCT { punct }
  | REASSIGN { reassign }
  | NOTHING { nothing }
  | LOOKUP { simpleAtom (dot name)+ }
}

simpleAtom {
    name
  | NUMBER { number }
  | STRING { string }
  | CHAR { char }
  | NULL { null }
  | SPECVAL { specval }
  | SPECFUN { specfun }
  | SPECMOD2 { specmod2 }
  | SYSVAL { sys val }
  | SYSFUN { sys fun }
  | SYSMOD1 { sys mod1 }
  | SYSMOD2 { sys mod2 }
  | LIST { "âŸ¨" exprM? "âŸ©" }
  | BLOCK { "{" exprM? "}" }
  | PAREN { "(" exprM? ")" }
  | ARRAY { "[" exprM? "]" }
}

name {
    VAL { val }
  | FUN { fun }
  | MOD1 { mod1 }
  | MOD2 { mod2 }
}

@tokens {
  space[@export] { $[\u0009 \u000b\u00a0\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]+ }
  newline[@export] { $[\r\n\u2028\u2029] }
  number    { "Â¯"? ( "âˆ" | mantissa ( ( "e" | "E" ) exponent )? ) }
  exponent  { "Â¯"? digit+ }
  mantissa  { "Ï€" | digit+ ( "." digit+ )? }
  digit     { "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9" }
  string    { '"' (!["])* '"'? }
  char      { "'" _ "'"? }
  null      { "@" }
  nothing   { "Â·" }
  dot       { "." }
  sys       { "â€¢" }
  reassign  { "â†©" }
  primfun   { "+" | "-" | "Ã—" | "Ã·" | "â‹†" | "âˆš" | "âŒŠ" | "âŒˆ" | "|" | "Â¬" | "âˆ§" | "âˆ¨" | "<" | ">" | "â‰ " | "=" | "â‰¤" | "â‰¥" | "â‰¡" | "â‰¢" | "âŠ£" | "âŠ¢" | "â¥Š" | "âˆ¾" | "â‰" | "â‹ˆ" | "â†‘" | "â†“" | "â†•" | "Â«" | "Â»" | "âŒ½" | "â‰" | "/" | "â‹" | "â’" | "âŠ" | "âŠ‘" | "âŠ" | "âŠ’" | "âˆŠ" | "â·" | "âŠ”" | "!" }
  primmod1  { "Ë™" | "Ëœ" | "Ë˜" | "Â¨" | "âŒœ" | "â¼" | "Â´" | "Ë" | "`" }
  primmod2  { "âˆ˜" | "â—‹" | "âŠ¸" | "âŸœ" | "âŒ¾" | "âŠ˜" | "â—¶" | "â‰" | "âš‡" | "âŸ" | "âŠ" }
  specfun   { "ğ•" | "ğ•" | "ğ”½" | "ğ”¾" | "ğ•Š" }
  specval   { "ğ•¨" | "ğ•©" | "ğ•—" | "ğ•˜" | "ğ•¤" }
  specmod2  { "_" "ğ•£" "_" | "ğ•£" }
  punct     { ";" | ":" | "?" }
  val       { $[a-z]$[a-zA-Z0-9_]* }
  fun       { $[A-Z]$[a-zA-Z0-9_]* }
  mod1      { "_" $[a-zA-Z0-9_]+ }
  mod2      { "_" $[a-zA-Z0-9_]+ "_" }
  COMMENT   { "#" ![\n]* }

  @precedence { mod2, mod1 }
}
