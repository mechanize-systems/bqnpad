# vm

MakeVar ‚Üê { program ùïä name:
  v‚Üê@
  Get  ‚áê !‚àò"Runtime: Variable referenced before definition"
  SetU ‚áê !‚àò"‚Ü©: Variable modified before definition"
  SetN ‚áê {
    Get ‚Ü© {ùï§‚ãÑv}
    (SetU ‚Ü© {v‚Ü©ùï©}) ùï©
  }
  SetQ ‚áê 0‚àòSetN
  GetC ‚áê {
    r ‚Üê Getùï©
    Get‚Ü©SetU‚Ü©SetN‚Ü©!‚àò"Internal error: Variable used after clear"
    r
  }
  GetF ‚áê {program ùï©.Field name}
}
vnot ‚Üê { SetU‚áêSetN‚áê‚ä¢ ‚ãÑ SetQ‚áê0Àô }
MakeEnv ‚Üê { ùïäp‚Äøv‚Äøn‚Äøe:
  ns ‚Üê v-‚â†n  # Number of special names
  parent ‚áê p
  program ‚áê p.program
  vars ‚áê program‚ä∏MakeVar¬® (ns‚•ä¬Ø1) ‚àæ n
  MakeNS ‚áê {ùï§
    v ‚Üê @ ‚ä£¬¥¬® n ‚äî ns‚Üìvars  # Lookup table
    Field ‚áê {ùï®ùïäi:
      cross ‚Üê ùï® { ùï®1‚äò‚â°ùï© ? ‚ä¢ ; ‚äë ùï©.names ‚äê ‚äè‚üúùï®.names } program
      (Cross i) ‚äë v
    }
  }
}

VO ‚Üê { d‚Üêùïè@, s‚Üêùïè@, s‚äë¬∑{ùï©.vars}{ùï©.parent}‚çüd }

nothing  ‚Üê {‚áê}
skipMark ‚Üê {‚áê}

Namespace ‚Üê {ùï©.MakeNS@}
ReadNS ‚Üê { e‚Äøi ùïä ùï©:
  "Key lookup in non-namespace" ! 6=‚Ä¢Typeùï©
  (e.program ùï©.Field i).Get @
}

ref ‚Üê {
  Matcher ‚áê {ùïä const:
    SetQ ‚áê constÀô ‚â¢ ‚ä¢
  }
  Array ‚áê {ùïä arr:
    Get  ‚áê {ùï©.Get@}¬® arrÀô
    _set_ ‚Üê {S _ùï£_ e:
      Err ‚Üê {(e‚àæ": "‚àæùï©)!e‚â°@ ‚ãÑ ‚ü®1‚ü©}
      {
        0=‚Ä¢Typeùï© ? arr ‚â°‚óã‚â¢‚ó∂‚ü®Err‚àò"Target and value shapes don't match", S¬®‚ü© ùï© ;
        # TODO "Cannot extract non-name from namespace" if ùï®.GetF doesn't exist
        6=‚Ä¢Typeùï© ? S‚üú({(ùï®.GetF ùï©).Get@}‚üúùï©)¬® arr ;
        Err "Multiple targets but atomic value"
      }
    }
    SetN ‚áê    {ùï®.SetNùï©}_set_"‚Üê"
    SetU ‚áê    {ùï®.SetUùï©}_set_"‚Üê"
    SetQ ‚áê ‚à®¬¥ {ùï®.SetQùï©}_set_@‚éä‚ü®1‚ü© # TODO fix GetF errors and avoid ‚éä
  }
  Alias ‚áê {env‚Äøname ùïä r:
    SetN‚ÄøSetU‚ÄøSetQ ‚áê r
    GetF ‚áê {env.program ùï©.Field name}
  }
}

Get ‚Üê {ùï©.Get @}‚öá0

MakeStack ‚Üê {
  s ‚Üê ùï©                          # Stack (a list)
  cont ‚áê 1                       # Whether to continue execution
  rslt ‚áê skipMark                # Result: skipMark to abort current body
  Push ‚áê {s‚àæ‚Ü©<ùï©}                 # Push a value
  Pop  ‚áê {t‚Üê-ùï© ‚ãÑ (s‚ÜìÀú‚Ü©t) ‚ä¢ ‚åΩt‚Üës} # Pop ùï© values; return as list
  Peek ‚áê {ùï§‚ãÑ¬Ø1‚äës}                # Return but don't pop top value
  Ret  ‚áê {rslt‚Ü©ùï© ‚ãÑ cont‚Ü©0 ‚ãÑ "Internal compiler error: Wrong stack size"!ùï®‚â•‚â†s}
  Skip ‚áê {ùï§‚ãÑ       cont‚Ü©0}
}

ops ‚Üê ((!‚àò"Unknown opcode")Àô‚ä£¬¥‚ä¢)¬® ‚äîÀù ‚çâ> ‚ü®
  # Constants and drop
   0‚Äø{i‚Üêùïè@ ‚ãÑ {sùïäe: s.Push         i‚äëe.program.consts } }
   1‚Äø{i‚Üêùïè@ ‚ãÑ {sùïäe: s.Push e {ùïéùï©}Àú i‚äëe.program.blocks } }
   6‚Äø(       {sùïäe: s.Pop 1 }Àô)
  # Returns
   7‚Äø(       {sùïäe: 0 s.Ret ‚äës.Pop 1 }Àô)
   8‚Äø(       {sùïäe: 1 s.Ret Namespace e }Àô)
  # Arrays
  11‚Äø{i‚Üêùïè@ ‚ãÑ {sùïäe: s.Push           ‚åΩs.Pop i } }
  12‚Äø{i‚Üêùïè@ ‚ãÑ {sùïäe: s.Push ref.Array ‚åΩs.Pop i } }
  # Application
  16‚Äø(       {sùïäe: s.Push {   f‚Äøx:   F x }   s.Pop 2 }Àô)
  17‚Äø(       {sùïäe: s.Push { w‚Äøf‚Äøx: w F x }   s.Pop 3 }Àô)
  20‚Äø(       {sùïäe: s.Push {   g‚Äøh:   G H }   s.Pop 2 }Àô)
  21‚Äø(       {sùïäe: s.Push { f‚Äøg‚Äøh: F G H }   s.Pop 3 }Àô)
  26‚Äø(       {sùïäe: s.Push { f‚Äøm  : F _m    } s.Pop 2 }Àô)
  27‚Äø(       {sùïäe: s.Push { f‚Äøm‚Äøg: F _m_ g } s.Pop 3 }Àô)
  # Application with Nothing
  18‚Äø(       {sùïäe: s.Push {   f‚Äøx:                     F‚çü(nothing‚ä∏‚â¢) x } s.Pop 2 }Àô) # Like 16
  19‚Äø(       {sùïäe: s.Push { w‚Äøf‚Äøx: (nothing‚â¢wÀô)‚ó∂‚ü®F,wÀô‚ä∏F‚ü©‚çü(nothing‚ä∏‚â¢) x } s.Pop 3 }Àô) # Like 17
  23‚Äø(       {sùïäe: s.Push { f‚Äøg‚Äøh: {f‚â°nothing?G H;F G H}               } s.Pop 3 }Àô) # Like 21
  22‚Äø(       {sùïäe: "Left argument required" ! nothing‚â¢s.Peek@ }Àô)
  # Variables
  32‚Äø{v‚ÜêVOùï©‚ãÑ {sùïäe: s.Push (V e).Get @ } }
  34‚Äø{v‚ÜêVOùï©‚ãÑ {sùïäe: s.Push (V e).GetC@ } }
  33‚Äø{v‚ÜêVOùï©‚ãÑ {sùïäe: s.Push  V e        } }
  # Headers
  42‚Äø(       {sùïäe: {0:s.Skip@; 1:@; ùïä:!"Predicate value must be 0 or 1"} ‚äës.Pop 1 }Àô)
  43‚Äø(       {sùïäe: s.Push ref.Matcher ‚äës.Pop 1 }Àô)
  44‚Äø(       {sùïäe: s.Push vnot }Àô)
  # Assignment
  47‚Äø(       {sùïäe: s.Skip‚çü‚ä¢{r‚Äø  v: r.SetQ   v           } s.Pop 2 }Àô)  # r:
  48‚Äø(       {sùïäe: s.Push { r‚Äø  v: r.SetN‚ä∏‚ä¢ v           } s.Pop 2 }Àô)  # r  ‚Üêv
  49‚Äø(       {sùïäe: s.Push { r‚Äø  v: r.SetU‚ä∏‚ä¢ v           } s.Pop 2 }Àô)  # r  ‚Ü©v
  50‚Äø(       {sùïäe: s.Push { r‚Äøf‚Äøx: r.SetU‚ä∏‚ä¢ (r.Get@)F x } s.Pop 3 }Àô)  # r F‚Ü©x
  51‚Äø(       {sùïäe: s.Push { r‚Äøf  : r.SetU‚ä∏‚ä¢ F r.Get@    } s.Pop 2 }Àô)  # r F‚Ü©
  # Namespaces
  64‚Äø{i‚Üêùïè@ ‚ãÑ {sùïäe: s.Push e‚Äøi ReadNS    ‚äës.Pop 1 } }
  66‚Äø{i‚Üêùïè@ ‚ãÑ {sùïäe: s.Push e‚Äøi ref.Alias ‚äës.Pop 1 } }
‚ü©

RunBC ‚Üê { bc‚Äøpos‚Äøenv:
  Next ‚Üê {ùï§‚ãÑ (pos+‚Ü©1) ‚ä¢ pos‚äëbc }
  stack ‚Üê MakeStack ‚ü®‚ü©
  Step ‚Üê {ùïä:
    op ‚Üê (Next@) ‚äë ops
    op ‚Ü© Op next
    stack Op env
    stack.cont
  }
  _while_ ‚Üê {ùîΩ‚çüùîæ‚àòùîΩ_ùï£_ùîæ‚àòùîΩ‚çüùîæùï©}
  Step _while_ ‚ä¢ 1
  stack.rslt
}

{ VM bc‚Äøconsts‚ÄøblockInfo‚ÄøbodyInfo‚Äøloc‚Äøtoken:

  bodies ‚Üê {start‚Äøvars‚Äønames‚Äøexport:
    {parent ùïä args:
      env ‚Üê MakeEnv parent‚Äøvars‚Äønames‚Äøexport
      (‚ä¢ {ùï©.SetN ùï®}¬® ‚â†‚Üëenv.varsÀô) args
      RunBC bc‚Äøstart‚Äøenv
    }
  }¬® bodyInfo

  blocks ‚Üê {type‚Äøimm‚Äøbody:
    inner ‚Üê imm ‚äë type ‚äë ‚ü®
      2‚•ä‚ü®{ùïän: N ‚ü®‚ü©}‚ü©
      {ùïän: {d‚ÜêN ùï£‚Äøùïó  ‚ãÑùï®Dùï©}}‚Äø{ùïän: {N ùï£‚Äøùïó  }}
      {ùïän: {d‚ÜêN ùï£‚Äøùïó‚Äøùïò‚ãÑùï®Dùï©}}‚Äø{ùïän: {N ùï£‚Äøùïó‚Äøùïò}}
    ‚ü©
    outer ‚Üê imm ‚äë ‚ü®
      {
        m‚Äød: {ùïäv: {M ùï§‚Äøùï©‚Äønothing‚àæv;D ùï§‚Äøùï©‚Äøùï®‚àæv}} ;
        ‚ü®b‚ü©: {ùïäv: {B ùï§‚Äøùï©‚Äø(ùï®‚ä£nothing)‚àæv}}
      }
      ‚äë
    ‚ü©

    nmc ‚Üê "No matching case"
    Then ‚Üê {first ùïä next: {skipMark‚â¢r‚Üêùï®Firstùï© ? r ; ùï®Nextùï©}}
    run ‚Üê {
      1=‚Ä¢Type ùï© ?
      ‚ü®(ùï©‚äëbodies) Then {!‚àònmc}‚ü©
    ;
      "Internal compiler error: Invalid body indices" ! 1==ùï©
      ! (‚â†ùï©) ‚â° 2-imm
      e ‚Üê {imm ? ‚ü®nmc‚ü© ;
        (0=‚â†¬®ùï©) nmc‚çü‚ä£¬® "Left argument "‚ä∏‚àæ¬®‚ü®"not allowed","required"‚ü©
      }ùï©
      ùï© Then¬¥‚üú(‚äè‚üúbodies)Àú‚üú{!‚àòùï©}¬® e
    } body

    {ùïä parent:
      Inner Outer {parentÀô ùïè ‚ä¢}¬® run
    }
  }¬® blockInfo

  program ‚Üê {
    consts‚áêconsts
    blocks‚áêblocks
    names‚áê0‚äë2‚äëtoken
  }
  
  (‚äëblocks){ùîΩ} {program‚áêprogram}
}

==>

PROGRAM(ASSIGN(FUN,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT),DELIM,ASSIGN(VAL,EXPR(NULL)),DELIM,EXPORT(FUN,EXPR(PRIMFUN,PRIMMOD2,STRING)),DELIM,EXPORT(FUN,EXPR(PRIMFUN,PRIMMOD2,STRING)),DELIM,EXPORT(FUN,EXPR(BLOCK(DELIM,EXPR(FUN,REASSIGN,BLOCK(EXPR(SPECVAL),DELIM,EXPR(VAL))),DELIM,EXPR(PAREN(EXPR(FUN,REASSIGN,BLOCK(EXPR(VAL,REASSIGN,SPECVAL)))),SPECVAL),DELIM))),DELIM,EXPORT(FUN,EXPR(NUMBER,PRIMMOD2,FUN)),DELIM,EXPORT(FUN,EXPR(BLOCK(DELIM,ASSIGN(VAL,EXPR(FUN,SPECVAL)),DELIM,EXPR(FUN,REASSIGN,FUN,REASSIGN,FUN,REASSIGN,PRIMFUN,PRIMMOD2,STRING),DELIM,EXPR(VAL),DELIM))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(VAL,LOOKUP(SPECVAL,FUN),VAL)))),DELIM))),DELIM,ASSIGN(VAL,EXPR(BLOCK(EXPORT(FUN,EXPORT(FUN,EXPR(PRIMFUN))),DELIM,EXPORT(FUN,EXPR(NUMBER,PRIMMOD1))))),DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(SPECFUN,STRIDE(VAL,VAL,VAL,VAL),PUNCT),DELIM,ASSIGN(VAL,EXPR(VAL,PRIMFUN,PRIMFUN,VAL)),DELIM,EXPORT(VAL,EXPR(VAL)),DELIM,EXPORT(VAL,EXPR(LOOKUP(VAL,VAL))),DELIM,EXPORT(VAL,EXPR(VAL,PRIMMOD2,FUN,PRIMMOD1,PAREN(EXPR(VAL,PRIMFUN,NUMBER)),PRIMFUN,VAL)),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(SPECVAL),DELIM,ASSIGN(VAL,EXPR(NULL,PRIMFUN,PRIMMOD1,PRIMMOD1,VAL,PRIMFUN,VAL,PRIMFUN,VAL)),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(SPECVAL,SPECFUN,VAL,PUNCT),DELIM,ASSIGN(VAL,EXPR(SPECVAL,BLOCK(EXPR(SPECVAL,NUMBER,PRIMMOD2,PRIMFUN,SPECVAL,PUNCT,PRIMFUN,PUNCT,PRIMFUN,LOOKUP(SPECVAL,VAL),PRIMFUN,PRIMFUN,PRIMMOD2,LOOKUP(SPECVAL,VAL))),VAL)),DELIM,EXPR(PAREN(EXPR(FUN,VAL)),PRIMFUN,VAL),DELIM))),DELIM))),DELIM))),DELIM,DELIM,ASSIGN(FUN,EXPR(BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(VAL,PRIMFUN,NOTHING,BLOCK(EXPR(LOOKUP(SPECVAL,VAL))),BLOCK(EXPR(LOOKUP(SPECVAL,VAL))),PRIMMOD2,VAL)))),DELIM,DELIM,ASSIGN(VAL,EXPR(BLOCK(EXPORT))),DELIM,ASSIGN(VAL,EXPR(BLOCK(EXPORT))),DELIM,DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(LOOKUP(SPECVAL,FUN),NULL)))),DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(STRIDE(VAL,VAL),SPECFUN,SPECVAL,PUNCT),DELIM,EXPR(STRING,PRIMFUN,NUMBER,PRIMFUN,SYSFUN,SPECVAL),DELIM,EXPR(LOOKUP(PAREN(EXPR(LOOKUP(VAL,VAL),LOOKUP(SPECVAL,FUN),VAL)),FUN),NULL),DELIM))),DELIM,DELIM,ASSIGN(VAL,EXPR(BLOCK(DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(SPECFUN,VAL,PUNCT),DELIM,EXPORT(FUN,EXPR(VAL,PRIMMOD1,PRIMFUN,PRIMFUN)),DELIM))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(SPECFUN,VAL,PUNCT),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(LOOKUP(SPECVAL,FUN),NULL)),PRIMMOD1,VAL,PRIMMOD1)),DELIM,ASSIGN(MOD2,EXPR(BLOCK(EXPR(FUN,SPECMOD2,VAL,PUNCT),DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(PAREN(EXPR(VAL,PRIMFUN,STRING,PRIMFUN,SPECVAL)),PRIMFUN,VAL,PRIMFUN,NULL),DELIM,EXPR(LIST(EXPR(NUMBER)))))),DELIM,EXPR(BLOCK(DELIM,EXPR(NUMBER,PRIMFUN,SYSFUN,SPECVAL,PUNCT,VAL,PRIMFUN,PRIMMOD2,PRIMFUN,PRIMMOD2,LIST(EXPR(FUN,PRIMMOD2,STRING),DELIM,EXPR(FUN,PRIMMOD1)),SPECVAL,PUNCT),DELIM,DELIM,EXPR(NUMBER,PRIMFUN,SYSFUN,SPECVAL,PUNCT,FUN,PRIMMOD2,PAREN(EXPR(BLOCK(EXPR(LOOKUP(PAREN(EXPR(LOOKUP(SPECVAL,FUN),SPECVAL)),FUN),NULL)),PRIMMOD2,SPECVAL)),PRIMMOD1,VAL,PUNCT),DELIM,EXPR(FUN,STRING),DELIM)),DELIM))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(LOOKUP(SPECVAL,FUN),SPECVAL)),MOD2,STRING)),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(LOOKUP(SPECVAL,FUN),SPECVAL)),MOD2,STRING)),DELIM,EXPORT(FUN,EXPR(PRIMFUN,PRIMMOD1,BLOCK(EXPR(LOOKUP(SPECVAL,FUN),SPECVAL)),MOD2,NULL,PRIMMOD2,LIST(EXPR(NUMBER)))),DELIM))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(STRIDE(VAL,VAL),SPECFUN,VAL,PUNCT),DELIM,EXPORT(STRIDE(FUN,FUN,FUN),EXPR(VAL)),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(LOOKUP(VAL,VAL),LOOKUP(SPECVAL,FUN),VAL)))),DELIM))),DELIM))),DELIM,DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(LOOKUP(SPECVAL,FUN),NULL)),PRIMMOD2,NUMBER)),DELIM,DELIM,ASSIGN(FUN,EXPR(BLOCK(DELIM,ASSIGN(VAL,EXPR(SPECVAL)),DELIM,EXPORT(VAL,EXPR(NUMBER)),DELIM,EXPORT(VAL,EXPR(VAL)),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(VAL,PRIMFUN,REASSIGN,PRIMFUN,SPECVAL)))),DELIM,EXPORT(FUN,EXPR(BLOCK(ASSIGN(VAL,EXPR(PRIMFUN,SPECVAL)),DELIM,EXPR(PAREN(EXPR(VAL,PRIMFUN,PRIMMOD1,REASSIGN,VAL)),PRIMFUN,PRIMFUN,VAL,PRIMFUN,VAL)))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(SPECVAL),DELIM,EXPR(NUMBER,PRIMFUN,VAL)))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(VAL,REASSIGN,SPECVAL),DELIM,EXPR(VAL,REASSIGN,NUMBER),DELIM,EXPR(STRING,PRIMFUN,SPECVAL,PRIMFUN,PRIMFUN,VAL)))),DELIM,EXPORT(FUN,EXPR(BLOCK(EXPR(SPECVAL),DELIM,EXPR(VAL,REASSIGN,NUMBER)))),DELIM))),DELIM,DELIM,ASSIGN(VAL,EXPR(PAREN(EXPR(PAREN(EXPR(PRIMFUN,PRIMMOD2,STRING)),PRIMMOD1,PRIMFUN,PRIMMOD1,PRIMFUN)),PRIMMOD1,PRIMFUN,PRIMMOD1,PRIMFUN,PRIMFUN,LIST(DELIM,DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),VAL,PRIMFUN,LOOKUP(VAL,VAL,VAL))))))),DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),VAL,BLOCK(EXPR(SPECFUN,SPECVAL)),PRIMMOD1,VAL,PRIMFUN,LOOKUP(VAL,VAL,VAL))))))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,NUMBER,LOOKUP(VAL,FUN),PRIMFUN,LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,NUMBER,LOOKUP(VAL,FUN),FUN,VAL)),PRIMMOD1)))),DELIM,DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),PRIMFUN,LOOKUP(VAL,FUN),VAL)))))),DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),LOOKUP(VAL,FUN),PRIMFUN,LOOKUP(VAL,FUN),VAL)))))),DELIM,DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,FUN,VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT,VAL,FUN,VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,FUN,FUN)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT,FUN,FUN,FUN)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,FUN,MOD1)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT,FUN,MOD2,VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,FUN,PRIMMOD2,PAREN(EXPR(VAL,PRIMMOD2,PRIMFUN)),VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT,PAREN(EXPR(VAL,PRIMFUN,VAL,PRIMMOD1)),PRIMMOD2,LIST(EXPR(FUN),DELIM,EXPR(VAL,PRIMMOD1,PRIMMOD2,FUN)),PRIMMOD2,PAREN(EXPR(VAL,PRIMMOD2,PRIMFUN)),VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT,BLOCK(EXPR(VAL,PRIMFUN,VAL,PUNCT,FUN,FUN,PUNCT,FUN,FUN,FUN)))),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,STRING,PRIMFUN,VAL,PRIMFUN,LOOKUP(VAL,FUN),NULL)),PRIMMOD1)))),DELIM,DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(FUN,SPECVAL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),LOOKUP(PAREN(EXPR(FUN,VAL)),FUN),NULL)))))),DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(FUN,SPECVAL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),LOOKUP(PAREN(EXPR(FUN,VAL)),FUN),NULL)))))),DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(FUN,SPECVAL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),FUN,VAL)))))),DELIM,DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,BLOCK(EXPR(NUMBER,PUNCT,LOOKUP(VAL,FUN),NULL,PUNCT,NUMBER,PUNCT,NULL,PUNCT,SPECFUN,PUNCT,PRIMFUN,STRING)),PRIMFUN,LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),LOOKUP(VAL,FUN),PRIMFUN,LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),VAL)),PRIMMOD1)))),DELIM,DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),PRIMMOD2,PRIMFUN,BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,LOOKUP(VAL,FUN),VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,LOOKUP(VAL,FUN),PRIMMOD2,PRIMFUN,VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,LOOKUP(VAL,FUN),PRIMMOD2,PRIMFUN,VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT,LOOKUP(VAL,FUN),PRIMMOD2,PRIMFUN,PAREN(EXPR(LOOKUP(VAL,FUN),NULL)),FUN,VAL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,EXPR(STRIDE(NUMBER,PAREN(EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),BLOCK(EXPR(STRIDE(VAL,VAL),PUNCT,LOOKUP(VAL,FUN),PRIMMOD2,PRIMFUN,FUN,LOOKUP(VAL,FUN),NULL)),LOOKUP(VAL,FUN),NUMBER)),PRIMMOD1)))),DELIM,DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),STRIDE(VAL,VAL),FUN,PRIMFUN,LOOKUP(VAL,FUN),NUMBER)))))),DELIM,EXPR(STRIDE(NUMBER,BLOCK(ASSIGN(VAL,EXPR(SPECFUN,NULL)),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,LOOKUP(VAL,FUN),STRIDE(VAL,VAL),LOOKUP(VAL,FUN),PRIMFUN,LOOKUP(VAL,FUN),NUMBER)))))),DELIM))),DELIM,DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT),DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(SPECVAL),DELIM,EXPR(PAREN(EXPR(VAL,PRIMFUN,REASSIGN,NUMBER)),PRIMFUN,VAL,PRIMFUN,VAL)))),DELIM,ASSIGN(VAL,EXPR(FUN,LIST)),DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(SPECFUN,PUNCT),DELIM,ASSIGN(VAL,EXPR(PAREN(EXPR(FUN,NULL)),PRIMFUN,VAL)),DELIM,EXPR(VAL,REASSIGN,FUN,VAL),DELIM,EXPR(VAL,FUN,VAL),DELIM,EXPR(LOOKUP(VAL,VAL)),DELIM))),DELIM,ASSIGN(MOD2,EXPR(BLOCK(EXPR(SPECFUN,PRIMMOD2,SPECFUN,PRIMMOD2,SPECFUN,SPECMOD2,SPECFUN,PRIMMOD2,SPECFUN,PRIMMOD2,SPECFUN,SPECVAL)))),DELIM,EXPR(FUN,MOD2,PRIMFUN,NUMBER),DELIM,EXPR(LOOKUP(VAL,VAL)),DELIM))),DELIM,DELIM,EXPR(BLOCK(EXPR(FUN,STRIDE(VAL,VAL,VAL,VAL,VAL,VAL),PUNCT),DELIM,DELIM,ASSIGN(VAL,EXPR(BLOCK(EXPR(STRIDE(VAL,VAL,VAL,VAL),PUNCT),DELIM,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT),DELIM,ASSIGN(VAL,EXPR(FUN,STRIDE(VAL,VAL,VAL,VAL))),DELIM,EXPR(PAREN(EXPR(PRIMFUN,BLOCK(EXPR(LOOKUP(SPECVAL,FUN),SPECVAL)),PRIMMOD1,PRIMFUN,PRIMFUN,LOOKUP(VAL,VAL),PRIMMOD1)),VAL),DELIM,EXPR(FUN,STRIDE(VAL,VAL,VAL)),DELIM)),DELIM),PRIMMOD1,VAL)),DELIM,DELIM,ASSIGN(VAL,EXPR(BLOCK(EXPR(STRIDE(VAL,VAL,VAL),PUNCT),DELIM,ASSIGN(VAL,EXPR(VAL,PRIMFUN,VAL,PRIMFUN,LIST(DELIM,EXPR(NUMBER,PRIMFUN,LIST(EXPR(BLOCK(EXPR(SPECFUN,VAL,PUNCT,FUN,LIST))))),DELIM,EXPR(STRIDE(BLOCK(EXPR(SPECFUN,VAL,PUNCT,BLOCK(ASSIGN(VAL,EXPR(FUN,STRIDE(SPECMOD2,SPECVAL))),DELIM,EXPR(SPECVAL,FUN,SPECVAL)))),BLOCK(EXPR(SPECFUN,VAL,PUNCT,BLOCK(EXPR(FUN,STRIDE(SPECMOD2,SPECVAL))))))),DELIM,EXPR(STRIDE(BLOCK(EXPR(SPECFUN,VAL,PUNCT,BLOCK(ASSIGN(VAL,EXPR(FUN,STRIDE(SPECMOD2,SPECVAL,SPECVAL))),DELIM,EXPR(SPECVAL,FUN,SPECVAL)))),BLOCK(EXPR(SPECFUN,VAL,PUNCT,BLOCK(EXPR(FUN,STRIDE(SPECMOD2,SPECVAL,SPECVAL))))))),DELIM))),DELIM,ASSIGN(VAL,EXPR(VAL,PRIMFUN,LIST(DELIM,EXPR(BLOCK(DELIM,EXPR(STRIDE(VAL,VAL),PUNCT,BLOCK(EXPR(SPECFUN,VAL,PUNCT,BLOCK(EXPR(FUN,STRIDE(SPECVAL,SPECVAL,VAL),PRIMFUN,VAL,PUNCT,FUN,STRIDE(SPECVAL,SPECVAL,SPECVAL),PRIMFUN,VAL)))),PUNCT),DELIM,EXPR(LIST(EXPR(VAL)),PUNCT,BLOCK(EXPR(SPECFUN,VAL,PUNCT,BLOCK(EXPR(FUN,STRIDE(SPECVAL,SPECVAL,PAREN(EXPR(SPECVAL,PRIMFUN,VAL))),PRIMFUN,VAL))))),DELIM)),DELIM,EXPR(PRIMFUN),DELIM))),DELIM,DELIM,ASSIGN(VAL,EXPR(STRING)),DELIM,ASSIGN(FUN,EXPR(BLOCK(EXPR(VAL,SPECFUN,VAL,PUNCT,BLOCK(ASSIGN(VAL,PRIMFUN,VAL,EXPR(SPECVAL,FUN,SPECVAL,PUNCT,VAL,PUNCT,SPECVAL,FUN,SPECVAL))))))),DELIM,ASSIGN(VAL,EXPR(BLOCK(DELIM,EXPR(NUMBER,PRIMFUN,SYSFUN,SPECVAL,PUNCT),DELIM,EXPR(LIST(EXPR(PAREN(EXPR(SPECVAL,PRIMFUN,VAL)),FUN,BLOCK(EXPR(PRIMFUN,PRIMMOD2,VAL))))),DELIM,EXPR(PUNCT),DELIM,EXPR(STRING,PRIMFUN,NUMBER,PRIMFUN,PRIMFUN,SPECVAL),DELIM,EXPR(PRIMFUN,PAREN(EXPR(PRIMFUN,SPECVAL)),PRIMFUN,NUMBER,PRIMFUN,VAL),DELIM,ASSIGN(VAL,EXPR(BLOCK(EXPR(VAL,PUNCT,LIST(EXPR(VAL)),PUNCT),DELIM,EXPR(PAREN(EXPR(NUMBER,PRIMFUN,PRIMFUN,PRIMMOD1,SPECVAL)),VAL,PRIMMOD2,PRIMFUN,PRIMMOD1,STRING,PRIMMOD2,PRIMFUN,PRIMMOD1,LIST(EXPR(STRING),DELIM,EXPR(STRING))),DELIM),SPECVAL)),DELIM,EXPR(SPECVAL,FUN,PRIMMOD1,PRIMMOD2,PAREN(EXPR(PRIMFUN,PRIMMOD2,VAL)),PRIMMOD1,PRIMMOD2,BLOCK(EXPR(PRIMFUN,PRIMMOD2,SPECVAL)),PRIMMOD1,VAL),DELIM),VAL)),DELIM,DELIM,EXPR(BLOCK(EXPR(SPECFUN,VAL,PUNCT),DELIM,EXPR(FUN,FUN,BLOCK(EXPR(VAL,PRIMMOD1,SPECFUN,PRIMFUN)),PRIMMOD1,VAL),DELIM)),DELIM),PRIMMOD1,VAL)),DELIM,DELIM,ASSIGN(VAL,EXPR(BLOCK(DELIM,EXPORT(VAL,EXPR(VAL)),DELIM,EXPORT(VAL,EXPR(VAL)),DELIM,EXPORT(VAL,EXPR(NUMBER,PRIMFUN,NUMBER,PRIMFUN,VAL)),DELIM))),DELIM,DELIM,EXPR(PAREN(EXPR(PRIMFUN,VAL)),BLOCK(EXPR(SPECFUN)),BLOCK(EXPORT(VAL,EXPR(VAL)))),DELIM)))
